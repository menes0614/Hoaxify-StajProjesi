{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Enes\\\\frontend\\\\src\\\\components\\\\ProfileCard.js\";\nimport React, { useState, useEffect } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\nimport { useSelector, useDispatch } from 'react-redux';\nimport ProfileImageWithDefault from './ProfileImageWithDefault';\nimport { useTranslation } from 'react-i18next';\nimport Input from './Input';\nimport { updateUser, deleteUser } from '../api/apiCalls';\nimport { useApiProgress } from '../shared/ApiProgress';\nimport ButtonWithProgress from './ButtonWithProgress';\nimport { updateSuccess, logoutSuccess } from '../redux/authActions';\nimport Modal from './Modal';\n\nconst ProfileCard = props => {\n  const [inEditMode, setInEditMode] = useState(false);\n  const [updatedDisplayName, setUpdatedDisplayName] = useState();\n  const {\n    username: loggedInUsername\n  } = useSelector(store => ({\n    username: store.username\n  }));\n  const routeParams = useParams();\n  const pathUsername = routeParams.username;\n  const [user, setUser] = useState({});\n  const [editable, setEditable] = useState(false);\n  const [newImage, setNewImage] = useState();\n  const [validationErrors, setValidationErrors] = useState({});\n  const [modalVisible, setModalVisible] = useState(false);\n  const dispatch = useDispatch();\n  const history = useHistory();\n  useEffect(() => {\n    setUser(props.user);\n  }, [props.user]);\n  useEffect(() => {\n    setEditable(pathUsername === loggedInUsername);\n  }, [pathUsername, loggedInUsername]);\n  useEffect(() => {\n    setValidationErrors(previousValidationErrors => ({ ...previousValidationErrors,\n      displayName: undefined\n    }));\n  }, [updatedDisplayName]);\n  useEffect(() => {\n    setValidationErrors(previousValidationErrors => ({ ...previousValidationErrors,\n      image: undefined\n    }));\n  }, [newImage]);\n  const {\n    username,\n    displayName,\n    image\n  } = user;\n  const pendingApiCallDeleteUser = useApiProgress('delete', `/api/1.0/users/${username}`, true);\n  const {\n    t\n  } = useTranslation();\n  useEffect(() => {\n    if (!inEditMode) {\n      setUpdatedDisplayName(undefined);\n      setNewImage(undefined);\n    } else {\n      setUpdatedDisplayName(displayName);\n    }\n  }, [inEditMode, displayName]);\n\n  const onClickSave = async () => {\n    let image;\n\n    if (newImage) {\n      image = newImage.split(',')[1];\n    }\n\n    const body = {\n      displayName: updatedDisplayName,\n      image\n    };\n\n    try {\n      const response = await updateUser(username, body);\n      setInEditMode(false);\n      setUser(response.data);\n      dispatch(updateSuccess(response.data));\n    } catch (error) {\n      setValidationErrors(error.response.data.validationErrors);\n    }\n  };\n\n  const onChangeFile = event => {\n    if (event.target.files.length < 1) {\n      return;\n    }\n\n    const file = event.target.files[0];\n    const fileReader = new FileReader();\n\n    fileReader.onloadend = () => {\n      setNewImage(fileReader.result);\n    };\n\n    fileReader.readAsDataURL(file);\n  };\n\n  const onClickCancel = () => {\n    setModalVisible(false);\n  };\n\n  const onClickDeleteUser = async () => {\n    await deleteUser(username);\n    setModalVisible(false);\n    dispatch(logoutSuccess());\n    history.push('/');\n  };\n\n  const pendingApiCall = useApiProgress('put', '/api/1.0/users/' + username);\n  const {\n    displayName: displayNameError,\n    image: imageError\n  } = validationErrors;\n  return React.createElement(\"div\", {\n    className: \"card text-center\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"card-header\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  }, React.createElement(ProfileImageWithDefault, {\n    className: \"rounded-circle shadow\",\n    width: \"200\",\n    height: \"200\",\n    alt: `${username} profile`,\n    image: image,\n    tempimage: newImage,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"card-body\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, !inEditMode && React.createElement(React.Fragment, null, React.createElement(\"h3\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }, displayName, \"@\", username), editable && React.createElement(React.Fragment, null, React.createElement(\"button\", {\n    className: \"btn btn-success d-inline-flex\",\n    onClick: () => setInEditMode(true),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }, React.createElement(\"i\", {\n    className: \"material-icons\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, \"edit\"), t('Edit')), React.createElement(\"div\", {\n    className: \"pt-2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"btn btn-danger d-inline-flex\",\n    onClick: () => setModalVisible(true),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135\n    },\n    __self: this\n  }, React.createElement(\"i\", {\n    className: \"material-icons\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136\n    },\n    __self: this\n  }, \"directions_run\"), t('Delete My Account'))))), inEditMode && React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, React.createElement(Input, {\n    label: t('Change Display Name'),\n    defaultValue: displayName,\n    onChange: event => {\n      setUpdatedDisplayName(event.target.value);\n    },\n    error: displayNameError,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  }), React.createElement(Input, {\n    type: \"file\",\n    onChange: onChangeFile,\n    error: imageError,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }, React.createElement(ButtonWithProgress, {\n    className: \"btn btn-primary d-inline-flex\",\n    onClick: onClickSave,\n    disabled: pendingApiCall,\n    pendingApiCall: pendingApiCall,\n    text: React.createElement(React.Fragment, null, React.createElement(\"i\", {\n      className: \"material-icons\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163\n      },\n      __self: this\n    }, \"save\"), t('Save')),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }), React.createElement(\"button\", {\n    className: \"btn btn-light d-inline-flex ml-1\",\n    onClick: () => setInEditMode(false),\n    disabled: pendingApiCall,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  }, React.createElement(\"i\", {\n    className: \"material-icons\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169\n    },\n    __self: this\n  }, \"close\"), t('Cancel'))))), React.createElement(Modal, {\n    visible: modalVisible,\n    title: t('Delete My Account'),\n    okButton: t('Delete My Account'),\n    onClickCancel: onClickCancel,\n    onClickOk: onClickDeleteUser,\n    message: t('Are you sure to delete your account?'),\n    pendingApiCall: pendingApiCallDeleteUser,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176\n    },\n    __self: this\n  }));\n};\n\nexport default ProfileCard;","map":{"version":3,"sources":["C:/Users/Enes/frontend/src/components/ProfileCard.js"],"names":["React","useState","useEffect","useParams","useHistory","useSelector","useDispatch","ProfileImageWithDefault","useTranslation","Input","updateUser","deleteUser","useApiProgress","ButtonWithProgress","updateSuccess","logoutSuccess","Modal","ProfileCard","props","inEditMode","setInEditMode","updatedDisplayName","setUpdatedDisplayName","username","loggedInUsername","store","routeParams","pathUsername","user","setUser","editable","setEditable","newImage","setNewImage","validationErrors","setValidationErrors","modalVisible","setModalVisible","dispatch","history","previousValidationErrors","displayName","undefined","image","pendingApiCallDeleteUser","t","onClickSave","split","body","response","data","error","onChangeFile","event","target","files","length","file","fileReader","FileReader","onloadend","result","readAsDataURL","onClickCancel","onClickDeleteUser","push","pendingApiCall","displayNameError","imageError","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useParams, useHistory } from 'react-router-dom';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport ProfileImageWithDefault from './ProfileImageWithDefault';\r\nimport { useTranslation } from 'react-i18next';\r\nimport Input from './Input';\r\nimport { updateUser, deleteUser } from '../api/apiCalls';\r\nimport { useApiProgress } from '../shared/ApiProgress';\r\nimport ButtonWithProgress from './ButtonWithProgress';\r\nimport { updateSuccess, logoutSuccess } from '../redux/authActions';\r\nimport Modal from './Modal';\r\n\r\nconst ProfileCard = props => {\r\n  const [inEditMode, setInEditMode] = useState(false);\r\n  const [updatedDisplayName, setUpdatedDisplayName] = useState();\r\n  const { username: loggedInUsername } = useSelector(store => ({ username: store.username }));\r\n  const routeParams = useParams();\r\n  const pathUsername = routeParams.username;\r\n  const [user, setUser] = useState({});\r\n  const [editable, setEditable] = useState(false);\r\n  const [newImage, setNewImage] = useState();\r\n  const [validationErrors, setValidationErrors] = useState({});\r\n  const [modalVisible, setModalVisible] = useState(false);\r\n  const dispatch = useDispatch();\r\n  const history = useHistory();\r\n\r\n  useEffect(() => {\r\n    setUser(props.user);\r\n  }, [props.user]);\r\n\r\n  useEffect(() => {\r\n    setEditable(pathUsername === loggedInUsername);\r\n  }, [pathUsername, loggedInUsername]);\r\n\r\n  useEffect(() => {\r\n    setValidationErrors(previousValidationErrors => ({\r\n      ...previousValidationErrors,\r\n      displayName: undefined\r\n    }));\r\n  }, [updatedDisplayName]);\r\n\r\n  useEffect(() => {\r\n    setValidationErrors(previousValidationErrors => ({\r\n      ...previousValidationErrors,\r\n      image: undefined\r\n    }));\r\n  }, [newImage]);\r\n\r\n  const { username, displayName, image } = user;\r\n\r\n  const pendingApiCallDeleteUser = useApiProgress('delete', `/api/1.0/users/${username}`, true);\r\n\r\n  const { t } = useTranslation();\r\n\r\n  useEffect(() => {\r\n    if (!inEditMode) {\r\n      setUpdatedDisplayName(undefined);\r\n      setNewImage(undefined);\r\n    } else {\r\n      setUpdatedDisplayName(displayName);\r\n    }\r\n  }, [inEditMode, displayName]);\r\n\r\n  const onClickSave = async () => {\r\n    let image;\r\n    if (newImage) {\r\n      image = newImage.split(',')[1];\r\n    }\r\n\r\n    const body = {\r\n      displayName: updatedDisplayName,\r\n      image\r\n    };\r\n    try {\r\n      const response = await updateUser(username, body);\r\n      setInEditMode(false);\r\n      setUser(response.data);\r\n      dispatch(updateSuccess(response.data));\r\n    } catch (error) {\r\n      setValidationErrors(error.response.data.validationErrors);\r\n    }\r\n  };\r\n\r\n  const onChangeFile = event => {\r\n    if (event.target.files.length < 1) {\r\n      return;\r\n    }\r\n    const file = event.target.files[0];\r\n    const fileReader = new FileReader();\r\n    fileReader.onloadend = () => {\r\n      setNewImage(fileReader.result);\r\n    };\r\n    fileReader.readAsDataURL(file);\r\n  };\r\n\r\n  const onClickCancel = () => {\r\n    setModalVisible(false);\r\n  };\r\n\r\n  const onClickDeleteUser = async () => {\r\n    await deleteUser(username);\r\n    setModalVisible(false);\r\n    dispatch(logoutSuccess());\r\n    history.push('/');\r\n  };\r\n  const pendingApiCall = useApiProgress('put', '/api/1.0/users/' + username);\r\n\r\n  const { displayName: displayNameError, image: imageError } = validationErrors;\r\n\r\n  return (\r\n    <div className=\"card text-center\">\r\n      <div className=\"card-header\">\r\n        <ProfileImageWithDefault\r\n          className=\"rounded-circle shadow\"\r\n          width=\"200\"\r\n          height=\"200\"\r\n          alt={`${username} profile`}\r\n          image={image}\r\n          tempimage={newImage}\r\n        />\r\n      </div>\r\n      <div className=\"card-body\">\r\n        {!inEditMode && (\r\n          <>\r\n            <h3>\r\n              {displayName}@{username}\r\n            </h3>\r\n            {editable && (\r\n              <>\r\n                <button className=\"btn btn-success d-inline-flex\" onClick={() => setInEditMode(true)}>\r\n                  <i className=\"material-icons\">edit</i>\r\n                  {t('Edit')}\r\n                </button>\r\n                <div className=\"pt-2\">\r\n                  <button className=\"btn btn-danger d-inline-flex\" onClick={() => setModalVisible(true)}>\r\n                    <i className=\"material-icons\">directions_run</i>\r\n                    {t('Delete My Account')}\r\n                  </button>\r\n                </div>\r\n              </>\r\n            )}\r\n          </>\r\n        )}\r\n        {inEditMode && (\r\n          <div>\r\n            <Input\r\n              label={t('Change Display Name')}\r\n              defaultValue={displayName}\r\n              onChange={event => {\r\n                setUpdatedDisplayName(event.target.value);\r\n              }}\r\n              error={displayNameError}\r\n            />\r\n            <Input type=\"file\" onChange={onChangeFile} error={imageError} />\r\n            <div>\r\n              <ButtonWithProgress\r\n                className=\"btn btn-primary d-inline-flex\"\r\n                onClick={onClickSave}\r\n                disabled={pendingApiCall}\r\n                pendingApiCall={pendingApiCall}\r\n                text={\r\n                  <>\r\n                    <i className=\"material-icons\">save</i>\r\n                    {t('Save')}\r\n                  </>\r\n                }\r\n              />\r\n              <button className=\"btn btn-light d-inline-flex ml-1\" onClick={() => setInEditMode(false)} disabled={pendingApiCall}>\r\n                <i className=\"material-icons\">close</i>\r\n                {t('Cancel')}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <Modal\r\n        visible={modalVisible}\r\n        title={t('Delete My Account')}\r\n        okButton={t('Delete My Account')}\r\n        onClickCancel={onClickCancel}\r\n        onClickOk={onClickDeleteUser}\r\n        message={t('Are you sure to delete your account?')}\r\n        pendingApiCall={pendingApiCallDeleteUser}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProfileCard;\r\n"]},"metadata":{},"sourceType":"module"}