{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Enes\\\\frontend\\\\src\\\\components\\\\HoaxSubmit.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { useSelector } from 'react-redux';\nimport ProfileImageWithDefault from './ProfileImageWithDefault';\nimport { useTranslation } from 'react-i18next';\nimport { postHoax, postHoaxAttachment } from '../api/apiCalls';\nimport { useApiProgress } from '../shared/ApiProgress';\nimport ButtonWithProgress from './ButtonWithProgress';\nimport Input from './Input';\nimport AutoUploadImage from './AutoUploadImage';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst HoaxSubmit = () => {\n  _s();\n\n  const {\n    image\n  } = useSelector(store => ({\n    image: store.image\n  }));\n  const [focused, setFocused] = useState(false);\n  const [hoax, setHoax] = useState('');\n  const [errors, setErrors] = useState({});\n  const [newImage, setNewImage] = useState();\n  const [attachmentId, setAttachmentId] = useState();\n  const {\n    t\n  } = useTranslation();\n  useEffect(() => {\n    if (!focused) {\n      setHoax('');\n      setErrors({});\n      setNewImage();\n      setAttachmentId();\n    }\n  }, [focused]);\n  useEffect(() => {\n    setErrors({});\n  }, [hoax]);\n  const pendingApiCall = useApiProgress('post', '/api/1.0/hoaxes', true);\n  const pendingFileUpload = useApiProgress('post', '/api/1.0/hoax-attachments', true);\n\n  const onClickHoaxify = async () => {\n    const body = {\n      content: hoax,\n      attachmentId: attachmentId\n    };\n\n    try {\n      await postHoax(body);\n      setFocused(false);\n    } catch (error) {\n      if (error.response.data.validationErrors) {\n        setErrors(error.response.data.validationErrors);\n      }\n    }\n  };\n\n  const onChangeFile = event => {\n    if (event.target.files.length < 1) {\n      return;\n    }\n\n    const file = event.target.files[0];\n    const fileReader = new FileReader();\n\n    fileReader.onloadend = () => {\n      setNewImage(fileReader.result);\n      uploadFile(file);\n    };\n\n    fileReader.readAsDataURL(file);\n  };\n\n  const uploadFile = async file => {\n    const attachment = new FormData();\n    attachment.append('file', file);\n    const response = await postHoaxAttachment(attachment);\n    setAttachmentId(response.data.id);\n  };\n\n  let textAreaClass = 'form-control';\n\n  if (errors.content) {\n    textAreaClass += ' is-invalid';\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"card p-1 flex-row\",\n    children: [/*#__PURE__*/_jsxDEV(ProfileImageWithDefault, {\n      image: image,\n      width: \"32\",\n      height: \"32\",\n      className: \"rounded-circle mr-1\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-fill\",\n      children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n        className: textAreaClass,\n        rows: focused ? '3' : '1',\n        onFocus: () => setFocused(true),\n        onChange: event => setHoax(event.target.value),\n        value: hoax\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invalid-feedback\",\n        children: errors.content\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 9\n      }, this), focused && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [!newImage && /*#__PURE__*/_jsxDEV(Input, {\n          type: \"file\",\n          onChange: onChangeFile\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 27\n        }, this), newImage && /*#__PURE__*/_jsxDEV(AutoUploadImage, {\n          image: newImage,\n          uploading: pendingFileUpload\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 26\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-right mt-1\",\n          children: [/*#__PURE__*/_jsxDEV(ButtonWithProgress, {\n            className: \"btn btn-primary\",\n            onClick: onClickHoaxify,\n            text: \"Hoaxify\",\n            pendingApiCall: pendingApiCall,\n            disabled: pendingApiCall || pendingFileUpload\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-light d-inline-flex ml-1\",\n            onClick: () => setFocused(false),\n            disabled: pendingApiCall || pendingFileUpload,\n            children: [/*#__PURE__*/_jsxDEV(\"i\", {\n              className: \"material-icons\",\n              children: \"close\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 102,\n              columnNumber: 17\n            }, this), t('Cancel')]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 5\n  }, this);\n};\n\n_s(HoaxSubmit, \"c2idVOZZED5q0+kUwLNT99GoTQ4=\", false, function () {\n  return [useSelector, useTranslation, useApiProgress, useApiProgress];\n});\n\n_c = HoaxSubmit;\nexport default HoaxSubmit;\n\nvar _c;\n\n$RefreshReg$(_c, \"HoaxSubmit\");","map":{"version":3,"sources":["C:/Users/Enes/frontend/src/components/HoaxSubmit.js"],"names":["React","useState","useEffect","useSelector","ProfileImageWithDefault","useTranslation","postHoax","postHoaxAttachment","useApiProgress","ButtonWithProgress","Input","AutoUploadImage","HoaxSubmit","image","store","focused","setFocused","hoax","setHoax","errors","setErrors","newImage","setNewImage","attachmentId","setAttachmentId","t","pendingApiCall","pendingFileUpload","onClickHoaxify","body","content","error","response","data","validationErrors","onChangeFile","event","target","files","length","file","fileReader","FileReader","onloadend","result","uploadFile","readAsDataURL","attachment","FormData","append","id","textAreaClass","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport ProfileImageWithDefault from './ProfileImageWithDefault';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { postHoax, postHoaxAttachment } from '../api/apiCalls';\r\nimport { useApiProgress } from '../shared/ApiProgress';\r\nimport ButtonWithProgress from './ButtonWithProgress';\r\nimport Input from './Input';\r\nimport AutoUploadImage from './AutoUploadImage';\r\n\r\nconst HoaxSubmit = () => {\r\n  const { image } = useSelector(store => ({ image: store.image }));\r\n  const [focused, setFocused] = useState(false);\r\n  const [hoax, setHoax] = useState('');\r\n  const [errors, setErrors] = useState({});\r\n  const [newImage, setNewImage] = useState();\r\n  const [attachmentId, setAttachmentId] = useState();\r\n  const { t } = useTranslation();\r\n\r\n  useEffect(() => {\r\n    if (!focused) {\r\n      setHoax('');\r\n      setErrors({});\r\n      setNewImage();\r\n      setAttachmentId();\r\n    }\r\n  }, [focused]);\r\n\r\n  useEffect(() => {\r\n    setErrors({});\r\n  }, [hoax]);\r\n\r\n  const pendingApiCall = useApiProgress('post', '/api/1.0/hoaxes', true);\r\n  const pendingFileUpload = useApiProgress('post', '/api/1.0/hoax-attachments', true);\r\n\r\n  const onClickHoaxify = async () => {\r\n    const body = {\r\n      content: hoax,\r\n      attachmentId: attachmentId\r\n    };\r\n\r\n    try {\r\n      await postHoax(body);\r\n      setFocused(false);\r\n    } catch (error) {\r\n      if (error.response.data.validationErrors) {\r\n        setErrors(error.response.data.validationErrors);\r\n      }\r\n    }\r\n  };\r\n\r\n  const onChangeFile = event => {\r\n    if (event.target.files.length < 1) {\r\n      return;\r\n    }\r\n    const file = event.target.files[0];\r\n    const fileReader = new FileReader();\r\n    fileReader.onloadend = () => {\r\n      setNewImage(fileReader.result);\r\n      uploadFile(file);\r\n    };\r\n    fileReader.readAsDataURL(file);\r\n  };\r\n\r\n  const uploadFile = async file => {\r\n    const attachment = new FormData();\r\n    attachment.append('file', file);\r\n    const response = await postHoaxAttachment(attachment);\r\n    setAttachmentId(response.data.id);\r\n  };\r\n\r\n  let textAreaClass = 'form-control';\r\n  if (errors.content) {\r\n    textAreaClass += ' is-invalid';\r\n  }\r\n\r\n  return (\r\n    <div className=\"card p-1 flex-row\">\r\n      <ProfileImageWithDefault image={image} width=\"32\" height=\"32\" className=\"rounded-circle mr-1\" />\r\n      <div className=\"flex-fill\">\r\n        <textarea\r\n          className={textAreaClass}\r\n          rows={focused ? '3' : '1'}\r\n          onFocus={() => setFocused(true)}\r\n          onChange={event => setHoax(event.target.value)}\r\n          value={hoax}\r\n        />\r\n        <div className=\"invalid-feedback\">{errors.content}</div>\r\n        {focused && (\r\n          <>\r\n            {!newImage && <Input type=\"file\" onChange={onChangeFile} />}\r\n            {newImage && <AutoUploadImage image={newImage} uploading={pendingFileUpload} />}\r\n            <div className=\"text-right mt-1\">\r\n              <ButtonWithProgress\r\n                className=\"btn btn-primary\"\r\n                onClick={onClickHoaxify}\r\n                text=\"Hoaxify\"\r\n                pendingApiCall={pendingApiCall}\r\n                disabled={pendingApiCall || pendingFileUpload}\r\n              />\r\n              <button className=\"btn btn-light d-inline-flex ml-1\" onClick={() => setFocused(false)} disabled={pendingApiCall || pendingFileUpload}>\r\n                <i className=\"material-icons\">close</i>\r\n                {t('Cancel')}\r\n              </button>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default HoaxSubmit;\r\n"]},"metadata":{},"sourceType":"module"}